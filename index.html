<!DOCTYPE html>
<html>

<head>
    <title>comapping</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css?family=Quicksand&display=swap');

        #map {
            width: 100%;
        }

        .leaflet-draw-toolbar {
            display: none;
        }

        .leaflet-control-container {
            position: absolute;
            top: 96px;
        }


        button {
            align-items: center;
            appearance: none;
            background-color: #FCFCFD;
            border-radius: 4px;
            border-width: 0;
            box-shadow: rgba(45, 35, 66, 0.4) 0 2px 4px, rgba(45, 35, 66, 0.3) 0 7px 13px -3px, #D6D6E7 0 -3px 0 inset;
            box-sizing: border-box;
            color: #36395A;
            cursor: pointer;
            display: inline-flex;
            font-family: "Quicksand";
            height: 24px;
            justify-content: center;
            line-height: 1;
            list-style: none;
            overflow: hidden;
            padding-left: 8px;
            padding-right: 8px;
            position: relative;
            text-align: left;
            text-decoration: none;
            transition: box-shadow .15s, transform .15s;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            white-space: nowrap;
            will-change: box-shadow, transform;
            font-size: 12px;
            left: 10px;
            top: 10px;
            z-index: 40000;
            margin-bottom: 5px;
        }

        .bitir {
            background-color: #565151;
            color: #ffffff;
            box-shadow: rgba(45, 35, 66, 0.4) 0 2px 4px, rgba(45, 35, 66, 0.3) 0 7px 13px -3px, #000000 0 -3px 0 inset;
        }

        .bitir:hover {
            box-shadow: rgba(45, 35, 66, 0.4) 0 2px 4px, rgba(45, 35, 66, 0.3) 0 7px 13px -3px, #000000 0 -3px 0 inset;
            transform: translateY(-2px);
        }

        button:focus {
            box-shadow: #D6D6E7 0 0 0 1.5px inset, rgba(45, 35, 66, 0.4) 0 2px 4px, rgba(45, 35, 66, 0.3) 0 7px 13px -3px, #D6D6E7 0 -3px 0 inset;
        }

        button:hover {
            box-shadow: rgba(45, 35, 66, 0.4) 0 4px 8px, rgba(45, 35, 66, 0.3) 0 7px 13px -3px, #D6D6E7 0 -3px 0 inset;
            transform: translateY(-2px);
        }

        button:active {
            box-shadow: #D6D6E7 0 3px 7px inset;
            transform: translateY(2px);
        }

        .image-txt-container {
            display: flex;
            align-items: center;
            flex-direction: row;
            font-family: "Quicksand";
            font-size: 12px;
        }

        .buttongroup {
            height: 0px;
        }
    </style>

</head>

<body>
    <div class="image-txt-container">
        <a href="https://aliyilmaz.info"><img
                src="https://lh4.googleusercontent.com/cbGDves_shwzfA4z5KuPjm868DBV37G7jlbyIhmxpw4ZHEAwMPNu_QUPPpN4XkUy2sqGenoXs3qsLmNA3ucimlw=w16383"
                style="width:220px;"></a>
        <p>&emsp;&emsp; Aƒüa√ß<br>&emsp;&emsp; Bank<br>&emsp;&emsp; Anƒ±t<br>&emsp;&emsp; Cafe</p>
        <p>&emsp;&emsp;: A<br>&emsp;&emsp;: B<br>&emsp;&emsp;: T<br>&emsp;&emsp;: C</p>
        <p>&emsp;&emsp;&emsp;&emsp; </p>
        <p>&emsp;&emsp; WC<br>&emsp;&emsp; Spor<br>&emsp;&emsp; K√ºlt√ºr/Sergi<br>&emsp;&emsp; </p>
        <p>&emsp;&emsp;: W<br>&emsp;&emsp;: S<br>&emsp;&emsp;: K<br>&emsp;&emsp; </p>
        <p>&emsp;&emsp;&emsp;&emsp; </p>
        <p>&emsp;&emsp; Yaya Yolu<br>&emsp;&emsp; Ye≈üil Alan<br>&emsp;&emsp; Meydan<br>&emsp;&emsp; </p>
        <p>&emsp;&emsp;: Y<br>&emsp;&emsp;: L<br>&emsp;&emsp;: M<br>&emsp;&emsp; </p>
        <p>&emsp;&emsp;&emsp;&emsp; </p>
        <p>&emsp;&emsp; Geri al<br>&emsp;&emsp; Temizle<br>&emsp;&emsp; Bitir ve y√ºkle<br>&emsp;&emsp; </p>
        <p>&emsp;&emsp;: Ctrl-Z<br>&emsp;&emsp;: Ctrl-R<br>&emsp;&emsp;: Ctrl-S<br>&emsp;&emsp; </p>
    </div>

    <div class="buttongroup">
        <button id="draw-agac">üå≥ Aƒüa√ß</button>
        <button id="draw-bench">ü™ë Bank</button>
        <button id="draw-statue">üóΩ Anƒ±t</button>
        <button id="draw-cafe">‚òïÔ∏è Cafe</button>
        <button id="draw-wc">üöΩ WC</button>
        <button id="draw-sport">üèÄ Spor</button>
        <button id="draw-culture">üé≠ K√ºlt√ºr/Sergi</button>

        <div>
            <button id="draw-path">üö∂üèª‚Äç‚ôÇÔ∏è Yaya yolu</button>
            <button id="draw-green">‚ú≥Ô∏è Ye≈üil alan</button>
            <button id="draw-square">üü® Meydan</button>
        </div>

        <button id="undo" class="bitir">‚ùÆ‚ùÆ Geri al</button>
        <button id="reset" class="bitir">üí´ Temizle</button>
        <button id="upload" class="bitir">üì§ Bitir ve y√ºkle</button>
    </div>

    <div id="map"></div>

    <script src="cdnjs.cloudflare.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>

    <script src=https://raw.githubusercontent.com/calvinmetcalf/leaflet-ajax/master/dist/leaflet.ajax.min.js></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropbox.js/10.34.0/Dropbox-sdk.min.js"></script>
    <script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs"
        data-app-key="3srgf2zk9ehxjuo"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet-src.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.toolbar.js/0.3.0/leaflet.toolbar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tooltip.js/1.3.3/tooltip.js"></script>

    <script>
        // ekrana mesaj √ßak ve nick iste
        setTimeout(function () {
            kullaniciadi = prompt(
                "≈ûu anda Sirkeci Garƒ±'ndan Emin√∂n√º'ne kadar olan hattƒ± keyfinize g√∂re tasarlamak √ºzeresiniz. Bunu katƒ±lƒ±mcƒ± planlama ve tasarƒ±m anlayƒ±≈üƒ± ile harmanlanan bir mek√¢nsal anket √ßalƒ±≈ümasƒ± olarak d√º≈ü√ºnebilirsiniz.\n\nHarita √ºzerinde bulunan yardƒ±mcƒ± butonlar vasƒ±tasƒ± ile fikirlerinizi haritaya ekleyebilir ve hayallerinizin ger√ßekle≈ümesini umabilirsiniz. Sizin gibi diƒüer ziyaret√ßiler de bu mek√¢nsal anketi hayalleri ile dolduruyor ve sonu√ßlarƒ± Matrix'te yer alan √ßok g√ºvenli bir sunucuya PTT ile g√∂nderiliyor.\n\nAnkete g√ºvenle devam edebilmeniz i√ßin annenizin evlenmeden √∂nceki soyadƒ±?\n\≈ûaka. Olmak istediƒüiniz ki≈üiyi giriniz.", "white rabbit"
            );
        }, 1000);

        // harita olu≈üturucu
        var map = L.map('map', {
            maxBounds: [[41.01874865817629, 28.971567095902117], [41.01413366017337, 28.97923475870823]]
        }).setView([41.016596, 28.975677], 17);

        // basemap ekleyici
        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v12/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1Ijoic2Fyc2FyaG9zIiwiYSI6ImNsZ3hzaGRodTAyajgzZXBlN2Z6bHR2eDkifQ._0BlgCaVYO1SCuriJa8Rig', {
            maxZoom: 20,
            minZoom: 17,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery ¬© <a href="http://mapbox.com">Mapbox</a>',
        }).addTo(map);



        // add scale bar to map
        L.control.scale().addTo(map);

        // add geojson file to map from website url as layer
        async function load_shapefile() {
            let url = 'https://raw.githubusercontent.com/aliyilma/comapping/main/sirkeci.geojson';
            const response = await fetch(url)
            const shape_obj = await response.json();
            console.log(shape_obj);
            return shape_obj;
        }
        load_shapefile().then(L.geoJson).then(map.addLayer.bind(map));

        var type;

        // √ßizim katmanlarƒ±nƒ± olu≈üturuyoruz
        var agacGroup = new L.FeatureGroup();
        map.addLayer(agacGroup);
        var bankGroup = new L.FeatureGroup();
        map.addLayer(bankGroup);
        var heykelGroup = new L.FeatureGroup();
        map.addLayer(heykelGroup);
        var yolGroup = new L.FeatureGroup();
        map.addLayer(yolGroup);
        var cafeGroup = new L.FeatureGroup();
        map.addLayer(cafeGroup);
        var wcGroup = new L.FeatureGroup();
        map.addLayer(wcGroup);
        var sportGroup = new L.FeatureGroup();
        map.addLayer(sportGroup);
        var kulturGroup = new L.FeatureGroup();
        map.addLayer(kulturGroup);
        var yesilGroup = new L.FeatureGroup();
        map.addLayer(yesilGroup);
        var meydanGroup = new L.FeatureGroup();
        map.addLayer(meydanGroup);

        // agac √ßizici
        var agacControl = new L.Control.Draw({
            edit: {
                featureGroup: agacGroup,
            },
            draw: {
                polygon: false,
                polyline: true,
                circle: false,
                circlemarker: false,
                rectangle: false,
            }
        });
        map.addControl(agacControl);

        // bank √ßizici
        var bankControl = new L.Control.Draw({
            edit: {
                featureGroup: bankGroup,
            },
            draw: {
                polygon: false,
                polyline: true,
                marker: true,
                circle: false,
                circlemarker: false,
                rectangle: false,
            }
        });
        map.addControl(bankControl);

        // heykel √ßizici
        var heykelControl = new L.Control.Draw({
            edit: {
                featureGroup: heykelGroup,
            },
            draw: {
                polygon: false,
                polyline: true,
                circle: false,
                circlemarker: false,
                rectangle: false,
            }
        });
        map.addControl(heykelControl);

        // yol √ßizici
        var yolControl = new L.Control.Draw({
            edit: {
                featureGroup: yolGroup,
            },
            draw: {
                polygon: false,
                polyline: true,
                circle: false,
                circlemarker: false,
                rectangle: false,
            }
        });
        map.addControl(yolControl);

        // cafe √ßizici
        var cafeControl = new L.Control.Draw({
            edit: {
                featureGroup: cafeGroup,
            },
            draw: {
                polygon: false,
                polyline: true,
                circle: false,
                circlemarker: false,
                rectangle: false,
            }
        });
        map.addControl(cafeControl);

        // wc √ßizici
        var wcControl = new L.Control.Draw({
            edit: {
                featureGroup: wcGroup,
            },
            draw: {
                polygon: false,
                polyline: true,
                circle: false,
                circlemarker: false,
                rectangle: false,
            }
        });
        map.addControl(wcControl);

        // sport √ßizici
        var sportControl = new L.Control.Draw({
            edit: {
                featureGroup: sportGroup,
            },
            draw: {
                polygon: false,
                polyline: true,
                circle: false,
                circlemarker: false,
                rectangle: false,
            }
        });
        map.addControl(sportControl);

        // kultur √ßizici
        var kulturControl = new L.Control.Draw({
            edit: {
                featureGroup: kulturGroup,
            },
            draw: {
                polygon: false,
                polyline: true,
                circle: false,
                circlemarker: false,
                rectangle: false,
            }
        });
        map.addControl(kulturControl);

        // ye≈üil alan √ßizici
        var yesilControl = new L.Control.Draw({
            // for polygon drawing
            edit: {
                featureGroup: yesilGroup,
            },
            draw: {
                polygon: true,
                polyline: false,
                circle: false,
                circlemarker: false,
                rectangle: false,
            }
        });
        map.addControl(yesilControl);

        // meydan √ßizici
        var meydanControl = new L.Control.Draw({
            // for polygon drawing
            edit: {
                featureGroup: meydanGroup,
            },
            draw: {
                polygon: true,
                polyline: false,
                circle: false,
                circlemarker: false,
                rectangle: false,
            }
        });
        map.addControl(meydanControl);

        // haritalarƒ±mƒ±za entity ekliyoruz
        map.on(L.Draw.Event.CREATED, function (e) {
            var type = e.layerType,
                layer = e.layer;

            if (type === 'marker') {
                if (layer.options.icon.options.iconUrl.includes("tree")) {
                    agacGroup.addLayer(layer);
                } else if (layer.options.icon.options.iconUrl.includes("bench")) {
                    bankGroup.addLayer(layer);
                } else if (layer.options.icon.options.iconUrl.includes("venus")) {
                    heykelGroup.addLayer(layer);
                } else if (layer.options.icon.options.iconUrl.includes("cafe")) {
                    cafeGroup.addLayer(layer);
                } else if (layer.options.icon.options.iconUrl.includes("diarrhea")) {
                    wcGroup.addLayer(layer);
                } else if (layer.options.icon.options.iconUrl.includes("basketball")) {
                    sportGroup.addLayer(layer);
                } else if (layer.options.icon.options.iconUrl.includes("mask")) {
                    kulturGroup.addLayer(layer);
                }
            } else if (type === 'polyline') {
                yolGroup.addLayer(layer);
            } else if (type === 'polygon') {
                if (layer.options.color.includes("yellow")) {
                    meydanGroup.addLayer(layer);
                } else if (layer.options.color.includes("green")) {
                    yesilGroup.addLayer(layer);
                }
            }
        });
        //----------- BUTON TIKLAYICILARI -----------------------------------------------------------------

        // A tu≈üuna ve butona tƒ±klayƒ±nca aƒüa√ß √ßiziciyi aktif ediyoruz
        document.getElementById('draw-agac').onclick = function (e) {
            agacControl.setDrawingOptions({
                marker: {
                    icon: new L.Icon({
                        iconUrl: 'https://img.icons8.com/ios-glyphs/30/40C057/deciduous-tree--v1.png',
                        shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                        iconSize: [24, 24],
                        iconAnchor: [12, 24],
                        shadowSize: [30, 30],
                        shadowAnchor: [15, 27]
                    }),
                },
            });
            type = 'agac';
            agacControl._toolbars.draw._modes.marker.handler.enable();
        }
        document.addEventListener('keydown', function (e) {
            if (e.keyCode == 65) {
                agacControl.setDrawingOptions({
                    marker: {
                        icon: new L.Icon({
                            iconUrl: 'https://img.icons8.com/ios-glyphs/30/40C057/deciduous-tree--v1.png',
                            shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                            iconSize: [24, 24],
                            iconAnchor: [12, 24],
                            shadowSize: [30, 30],
                            shadowAnchor: [15, 27]
                        }),
                    },
                });
                type = 'agac';
                agacControl._toolbars.draw._modes.marker.handler.enable();
            }
        });

        // butona tƒ±klayƒ±nca bank √ßiziciyi aktif ediyoruz
        document.getElementById('draw-bench').onclick = function (e) {
            bankControl.setDrawingOptions({
                marker: {
                    icon: new L.Icon({
                        iconUrl: 'https://img.icons8.com/ios-glyphs/30/FD7E14/city-bench.png',
                        shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                        iconSize: [24, 24],
                        iconAnchor: [12, 24],
                        shadowSize: [30, 30],
                        shadowAnchor: [15, 27]
                    }),
                },
            });
            type = 'bank';
            bankControl._toolbars.draw._modes.marker.handler.enable();
        }
        document.addEventListener('keydown', function (e) {
            if (e.keyCode == 66) {
                bankControl.setDrawingOptions({
                    marker: {
                        icon: new L.Icon({
                            iconUrl: 'https://img.icons8.com/ios-glyphs/30/FD7E14/city-bench.png',
                            shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                            iconSize: [24, 24],
                            iconAnchor: [12, 24],
                            shadowSize: [30, 30],
                            shadowAnchor: [15, 27]
                        }),
                    },
                });
                type = 'bank';
                bankControl._toolbars.draw._modes.marker.handler.enable();
            }
        });

        // T tu≈üuna ve butona tƒ±klayƒ±nca heykel √ßiziciyi aktif ediyoruz
        document.getElementById('draw-statue').onclick = function (e) {
            heykelControl.setDrawingOptions({
                marker: {
                    icon: new L.Icon({
                        iconUrl: 'https://img.icons8.com/ios-filled/50/FA5252/venus-de-milo--v2.png',
                        shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                        iconSize: [24, 24],
                        iconAnchor: [12, 24],
                        shadowSize: [30, 30],
                        shadowAnchor: [15, 27]
                    }),
                },
            });
            type = 'heykel';
            heykelControl._toolbars.draw._modes.marker.handler.enable();
        }
        document.addEventListener('keydown', function (e) {
            if (e.keyCode == 84) {
                heykelControl.setDrawingOptions({
                    marker: {
                        icon: new L.Icon({
                            iconUrl: 'https://img.icons8.com/ios-filled/50/FA5252/venus-de-milo--v2.png',
                            shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                            iconSize: [24, 24],
                            iconAnchor: [12, 24],
                            shadowSize: [30, 30],
                            shadowAnchor: [15, 27]
                        }),
                    },
                });
                type = 'heykel';
                heykelControl._toolbars.draw._modes.marker.handler.enable();
            }
        });

        // C tu≈üuna ve butona tƒ±klayƒ±nca cafe √ßiziciyi aktif ediyoruz
        document.getElementById('draw-cafe').onclick = function (e) {
            cafeControl.setDrawingOptions({
                marker: {
                    icon: new L.Icon({
                        iconUrl: 'https://img.icons8.com/parakeet/48/null/cafe.png',
                        shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                        iconSize: [24, 24],
                        iconAnchor: [12, 24],
                        shadowSize: [30, 30],
                        shadowAnchor: [15, 27]
                    }),
                },
            });
            type = 'cafe';
            cafeControl._toolbars.draw._modes.marker.handler.enable();
        }
        document.addEventListener('keydown', function (e) {
            if (e.keyCode == 67) {
                cafeControl.setDrawingOptions({
                    marker: {
                        icon: new L.Icon({
                            iconUrl: 'https://img.icons8.com/parakeet/48/null/cafe.png',
                            shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                            iconSize: [24, 24],
                            iconAnchor: [12, 24],
                            shadowSize: [30, 30],
                            shadowAnchor: [15, 27]
                        }),
                    },
                });
                type = 'cafe';
                cafeControl._toolbars.draw._modes.marker.handler.enable();
            }
        });

        // W tu≈üuna ve butona tƒ±klayƒ±nca wc √ßiziciyi aktif ediyoruz
        document.getElementById('draw-wc').onclick = function (e) {
            wcControl.setDrawingOptions({
                marker: {
                    icon: new L.Icon({
                        iconUrl: 'https://img.icons8.com/arcade/64/null/diarrhea.png',
                        shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                        iconSize: [24, 24],
                        iconAnchor: [12, 24],
                        shadowSize: [30, 30],
                        shadowAnchor: [15, 27]
                    }),
                },
            });
            type = 'wc';
            wcControl._toolbars.draw._modes.marker.handler.enable();
        }
        document.addEventListener('keydown', function (e) {
            if (e.keyCode == 87) {
                wcControl.setDrawingOptions({
                    marker: {
                        icon: new L.Icon({
                            iconUrl: 'https://img.icons8.com/arcade/64/null/diarrhea.png',
                            shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                            iconSize: [24, 24],
                            iconAnchor: [12, 24],
                            shadowSize: [30, 30],
                            shadowAnchor: [15, 27]
                        }),
                    },
                });
                type = 'wc';
                wcControl._toolbars.draw._modes.marker.handler.enable();
            }
        });

        // S tu≈üuna ve butona tƒ±klayƒ±nca spor √ßiziciyi aktif ediyoruz
        document.getElementById('draw-sport').onclick = function (e) {
            sportControl.setDrawingOptions({
                marker: {
                    icon: new L.Icon({
                        iconUrl: 'https://img.icons8.com/color/48/null/basketball.png',
                        shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                        iconSize: [24, 24],
                        iconAnchor: [12, 24],
                        shadowSize: [30, 30],
                        shadowAnchor: [15, 27]
                    }),
                },
            });
            type = 'sport';
            sportControl._toolbars.draw._modes.marker.handler.enable();
        }
        document.addEventListener('keydown', function (e) {
            if (e.keyCode == 83) {
                sportControl.setDrawingOptions({
                    marker: {
                        icon: new L.Icon({
                            iconUrl: 'https://img.icons8.com/color/48/null/basketball.png',
                            shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                            iconSize: [24, 24],
                            iconAnchor: [12, 24],
                            shadowSize: [30, 30],
                            shadowAnchor: [15, 27]
                        }),
                    },
                });
                type = 'sport';
                sportControl._toolbars.draw._modes.marker.handler.enable();
            }
        });

        // butona tƒ±klayƒ±nca kultur √ßiziciyi aktif ediyoruz
        document.getElementById('draw-culture').onclick = function (e) {
            kulturControl.setDrawingOptions({
                marker: {
                    icon: new L.Icon({
                        iconUrl: 'https://img.icons8.com/office/30/null/theatre-mask.png',
                        shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                        iconSize: [25, 25],
                        iconAnchor: [12, 25],
                        shadowSize: [32, 32],
                        shadowAnchor: [16, 27]
                    }),
                },
            });
            type = 'kultur';
            kulturControl._toolbars.draw._modes.marker.handler.enable();
        }
        document.addEventListener('keydown', function (e) {
            if (e.keyCode == 75) {
                kulturControl.setDrawingOptions({
                    marker: {
                        icon: new L.Icon({
                            iconUrl: 'https://img.icons8.com/office/30/null/theatre-mask.png',
                            shadowUrl: 'https://img.icons8.com/ios-filled/50/FFFFFF/filled-circle.png',
                            iconSize: [25, 25],
                            iconAnchor: [12, 25],
                            shadowSize: [32, 32],
                            shadowAnchor: [16, 27]
                        }),
                    },
                });
                type = 'kultur';
                kulturControl._toolbars.draw._modes.marker.handler.enable();
            }
        });

        // butona tƒ±klayƒ±nca yol √ßiziciyi aktif ediyoruz
        document.getElementById('draw-path').onclick = function (e) {
            yolControl.setDrawingOptions({
                polyline: {
                    shapeOptions: {
                        color: 'yellow',
                        weight: 6,
                        opacity: 0.75,
                        lineCap: "square",
                    },
                },
            });
            type = 'yol';
            yolControl._toolbars.draw._modes.polyline.handler.enable();
        }
        document.addEventListener('keydown', function (e) {
            if (e.keyCode == 89) {
                yolControl.setDrawingOptions({
                    polyline: {
                        shapeOptions: {
                            color: 'yellow',
                            weight: 6,
                            opacity: 0.75,
                            lineCap: "square",
                        },
                    },
                });
                type = 'yol';
                yolControl._toolbars.draw._modes.polyline.handler.enable();
            }
        });

        // butona tƒ±klayƒ±nca ye≈üil alan √ßiziciyi aktif ediyoruz
        document.getElementById('draw-green').onclick = function (e) {
            yesilControl.setDrawingOptions({
                polygon: {
                    shapeOptions: {
                        color: 'green',
                        weight: 2,
                        opacity: 1,
                        fillColor: 'green',
                        fillOpacity: 0.5,
                        fill: true
                    },
                },
            });
            type = 'yesil';
            yesilControl._toolbars.draw._modes.polygon.handler.enable();
        }
        document.addEventListener('keydown', function (e) {
            if (e.keyCode == 76) {
                yesilControl.setDrawingOptions({
                    polygon: {
                        shapeOptions: {
                            color: 'green',
                            weight: 2,
                            opacity: 1,
                            fillColor: 'green',
                            fillOpacity: 0.5,
                            fill: true
                        },
                    },
                });
                type = 'yesil';
                yesilControl._toolbars.draw._modes.polygon.handler.enable();
            }
        });

        // butona tƒ±klayƒ±nca meydan √ßiziciyi aktif ediyoruz
        document.getElementById('draw-square').onclick = function (e) {
            meydanControl.setDrawingOptions({
                polygon: {
                    shapeOptions: {
                        color: 'yellow',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.5,
                        fill: true
                    },
                },
            });
            type = 'meydan';
            meydanControl._toolbars.draw._modes.polygon.handler.enable();
        }
        document.addEventListener('keydown', function (e) {
            if (e.keyCode == 77) {
                meydanControl.setDrawingOptions({
                    polygon: {
                        shapeOptions: {
                            color: 'yellow',
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.5,
                            fill: true
                        },
                    },
                });
                type = 'meydan';
                meydanControl._toolbars.draw._modes.polygon.handler.enable();
            }
        });
        
        // butona tƒ±klayƒ±nca √ßizilenleri temizliyoruz
        document.getElementById('reset').onclick = function (e) { clearDraw(); }

        // butona veya ctrl/cmd z tu≈üuna basƒ±nca son √ßizileni siliyoruz
        document.getElementById("undo").addEventListener("click", undoDraw);
        document.addEventListener("keydown", function (event) {
            event.preventDefault(); // burasƒ± √∂nemli
            if (event.keyCode == 90 && (navigator.platform.match("Mac") ? event.metaKey : event.ctrlKey)) {
                undoDraw();
            }
        });

        // butona tƒ±klayƒ±nca veya windows i√ßin ctrl s, mac i√ßin cmd s tu≈üuna basƒ±nca dropbox'a y√ºkler
        document.getElementById("upload").addEventListener("click", areYouSure);
        document.addEventListener("keydown", function (event) {
            event.preventDefault(); // burasƒ± √∂nemli
            if (event.keyCode == 83 && (navigator.platform.match("Mac") ? event.metaKey : event.ctrlKey)) {
                areYouSure();
            }
        });

        //----------- FONKSƒ∞YONLAR -----------------------------------------------------------------

        // Emin misin sorusu
        function areYouSure() {
            if (window.confirm("Ger√ßekten mi?")) {
                uploadZipFile();
            }
        }

        // geojsonlarƒ± zipleyip dropboxa y√ºkl√ºyoruz
        function uploadZipFile() {
            var zip = new JSZip();
            zip.file("agac.geojson", JSON.stringify(agacGroup.toGeoJSON()));
            zip.file("bank.geojson", JSON.stringify(bankGroup.toGeoJSON()));
            zip.file("heykel.geojson", JSON.stringify(heykelGroup.toGeoJSON()));
            zip.file("yol.geojson", JSON.stringify(yolGroup.toGeoJSON()));
            zip.file("yesil.geojson", JSON.stringify(yesilGroup.toGeoJSON()));
            zip.file("wc.geojson", JSON.stringify(wcGroup.toGeoJSON()));
            zip.file("sport.geojson", JSON.stringify(sportGroup.toGeoJSON()));
            zip.file("kultur.geojson", JSON.stringify(kulturGroup.toGeoJSON()));
            zip.file("cafe.geojson", JSON.stringify(cafeGroup.toGeoJSON()));
            zip.file("meydan.geojson", JSON.stringify(meydanGroup.toGeoJSON()));

            zip.generateAsync({ type: "blob" }).then(function (content) {
                // Dosya adƒ±nƒ± olu≈üturmak i√ßin getFileName fonksiyonunu kullanƒ±yoruz
                var file = new File([content], getFileName() + ".zip");
                // Dropbox API v2 ile dosya y√ºkleme
                var ACCESS_TOKEN = "sl.BdQKaAg5knST8pTetRKp09GETRyYCf6rEkgZPktO4x8569ypP5WjOxXRFwrOQRtVbIqk4r2KXZQLd0EEbP1Ybt_UwzTk9dN3vEHe6evqJuhx4RDb1mo_HuQDMe5bw5ZetCSNAp0";
                var dbx = new Dropbox.Dropbox({
                    clientId: '3srgf2zk9ehxjuo',
                    clientSecret: "sox2f4bp0rora92",
                    refreshToken: "tS2SLNlfrDYAAAAAAAAAAdnWBjf2gdtW8RgC_2lGL30fBqX_gp-otnyQnVkGzY9f"
                });

                dbx.filesUpload({ path: "/" + file.name, contents: file })
                    .then(function (response) {
                        console.log("Dosya ba≈üarƒ±yla y√ºklendi.");
                        alert("Oldu! Sayenizde Matrix'i g√ºncelledik.");
                    })
                    .catch(function (error) {
                        console.error(error);
                        // download file instead of uploading
                        var downloadUrl = URL.createObjectURL(file);
                        var link = document.createElement("a");
                        link.href = downloadUrl;
                        link.download = file.name;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);

                        if (window.confirm('Matrix\'te bir hata ile kar≈üƒ±la≈ütƒ±k fakat √ßalƒ±≈ümalarƒ±nƒ± kurtardƒ±k.\n\nTamam\'ƒ± se√ßersen kodu d√ºzeltmek i√ßin bir ≈üans verip bize tasarƒ±mƒ±nƒ± mail atabilirsin. Vazge√ß\'i se√ßersen her ≈üey sona erer ve hayatƒ±na geri d√∂nersin.')) {
                            window.location.href = 'mailto:yilmazali13@itu.edu.tr';
                        };
                    });
            });
            bankGroup.clearLayers();
            agacGroup.clearLayers();
            heykelGroup.clearLayers();
            yolGroup.clearLayers();
            yesilGroup.clearLayers();
            wcGroup.clearLayers();
            sportGroup.clearLayers();
            kulturGroup.clearLayers();
            cafeGroup.clearLayers();
            meydanGroup.clearLayers();
        }

        // dosya adƒ± olu≈üturucu
        function getFileName() {
            var date = new Date();
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            var hour = date.getHours();
            var minute = date.getMinutes();
            var second = date.getSeconds();
            return "map_" + kullaniciadi + "-" + month + "-" + day + "_" + hour + "-" + minute + "-" + second;
        }

        // geri alƒ±cƒ±
        function undoDraw() {
            if (type == 'bank') {
                bankGroup.removeLayer(bankGroup.getLayers()[bankGroup.getLayers().length - 1]);
            } if (type == 'agac') {
                agacGroup.removeLayer(agacGroup.getLayers()[agacGroup.getLayers().length - 1]);
            } else if (type == 'heykel') {
                heykelGroup.removeLayer(heykelGroup.getLayers()[heykelGroup.getLayers().length - 1]);
            } else if (type == 'yol') {
                yolGroup.removeLayer(yolGroup.getLayers()[yolGroup.getLayers().length - 1]);
            } else if (type == 'wc') {
                wcGroup.removeLayer(wcGroup.getLayers()[wcGroup.getLayers().length - 1]);
            } else if (type == 'sport') {
                sportGroup.removeLayer(sportGroup.getLayers()[sportGroup.getLayers().length - 1]);
            } else if (type == 'kultur') {
                kulturGroup.removeLayer(kulturGroup.getLayers()[kulturGroup.getLayers().length - 1]);
            } else if (type == 'yesil') {
                yesilGroup.removeLayer(yesilGroup.getLayers()[yesilGroup.getLayers().length - 1]);
            } else if (type == 'meydan') {
                meydanGroup.removeLayer(meydanGroup.getLayers()[meydanGroup.getLayers().length - 1]);
            } else if (type == 'cafe') {
                cafeGroup.removeLayer(cafeGroup.getLayers()[cafeGroup.getLayers().length - 1]);
            }
        }

        // √ßizim temizleyici
        function clearDraw() {
            if (window.confirm("Yanlƒ±≈ülƒ±kla basma diye buradayƒ±m. Emin misin?")) {
                bankGroup.clearLayers();
                agacGroup.clearLayers();
                heykelGroup.clearLayers();
                yolGroup.clearLayers();
                yesilGroup.clearLayers();
                wcGroup.clearLayers();
                sportGroup.clearLayers();
                kulturGroup.clearLayers();
                cafeGroup.clearLayers();
                meydanGroup.clearLayers();
            }
        }

        // haritayƒ± resize edici
        $(window).on("resize", function () {
            $("#map").height($(window).height() - 100).width($(window).width() - 15);
            map.invalidateSize();
        }).trigger("resize");

    </script>

</body>

</html>